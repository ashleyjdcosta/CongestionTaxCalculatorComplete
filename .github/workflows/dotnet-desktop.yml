name: .NET Core CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        configuration: [ Debug, Release ]

    env:
      API_PROJECT: congestion-tax-api/congestion-tax-api.csproj
      TEST_PROJECT: congestion-tax-unit-tests/congestion-tax-unit-tests.csproj

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup .NET SDK
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.x

      - name: Restore API
        run: dotnet restore ${{ env.API_PROJECT }}

      - name: Restore Tests
        run: dotnet restore ${{ env.TEST_PROJECT }}

      - name: Build API
        run: dotnet build ${{ env.API_PROJECT }} \
              --configuration ${{ matrix.configuration }} \
              --no-restore

      - name: Build Tests
        run: dotnet build ${{ env.TEST_PROJECT }} \
              --configuration ${{ matrix.configuration }} \
              --no-restore

      - name: Run Tests
        run: dotnet test ${{ env.TEST_PROJECT }} \
              --configuration ${{ matrix.configuration }} \
              --no-build \
              --verbosity normal
